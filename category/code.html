<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>möchte­gern­geek - Code category</title>
<meta content="Dinge, die ich für hübsch, praktisch oder interessant halte." name="description"/>
<meta content="Hendrik Schawe" name="author"/>
<meta content="Hendrik Schawe" name="copyright"/>
<meta content="#3d4f5d" name="theme-color"/>
<link href="/manifest.json" rel="manifest"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Add to home screen for Safari on iOS-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="möchtegerngeek" name="apple-mobile-web-app-title"/>
<link href="/extra/icons/icon-152x152.png" rel="apple-touch-icon"/>
<!-- Add to home screen for Windows-->
<meta content="/extra/icons/icon-152x152.png" name="msapplication-TileImage"/>
<meta content="#b0cadb" name="msapplication-TileColor"/>
<meta content="möchte­gern­geek" property="og:site_name"/>
<meta content="Hendrik Schawe" property="og:article:author"/>
<meta content="article" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://blog.schawe.me/img/logo.png" property="og:image"/>
<meta content="https://blog.schawe.me/img/logo.png" name="twitter:image"/>
<link href="https://blog.schawe.me/category/code.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/en/category/code.html" hreflang="en" rel="alternate">
<link href="https://blog.schawe.me/category/code.html" hreflang="x-default" rel="alternate">
<link href="/theme/webassets-external/6fc8b5d0286641a8981481d8734adb14_pure-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/webassets-external/cd1fc9b8f4fd6935866873d6d3cfad1b_grids-responsive-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/blog.css" rel="stylesheet" type="text/css"/>
<script async="" src="/theme/js/mathjax-config.js"></script>
<script async="" crossorigin="anonymous" data-search-pseudo-elements="" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
<!-- Preload the other fonts early -->
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptRegular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Bold.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptItalic.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-bold.woff2" rel="prefetch" type="font/woff2"/>
<link href="https://blog.schawe.me/feeds/all.atom.xml" rel="alternate" title="möchte­gern­geek - Full Atom Feed" type="application/atom+xml">
</link></link></link></link></head>
<body>
<div class="pure-g" id="layout">
<div class="sidebar pure-u-1 pure-u-lg-1-4">
<div class="header">
<h1 class="brand-title"><a href="https://blog.schawe.me">möchte­gern­geek</a></h1>
<nav class="nav">
<ul class="nav-list container">
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/"><i class="fa fa-globe"></i> en</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/categories.html">Kategorien</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/tags.html">Tags</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/archives.html">Archiv</a>
</li>
</ul>
</nav>
<div class="container">
<a class="sidebar-social-links" href="https://hendrik.schawe.me" rel="noopener" target="_blank" title="Ich">
<i class="fas fa-user sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://github.com/surt91" rel="noopener" target="_blank" title="GitHub">
<i class="fab fa-github sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="mailto:hendrik.schawe+blog@gmail.com" rel="noopener" target="_blank" title="Email">
<i class="fas fa-envelope sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://twitter.com/surt91" rel="noopener" target="_blank" title="Twitter">
<i class="fab fa-twitter sidebar-social-links"></i>
</a>
</div>
<div class="container">
<form action="https://blog.schawe.me/search.html" class="pure-form">
<fieldset>
<input aria-label="Suche" class="search-query" id="tipue_search_input" name="q" placeholder="Suche" type="text"/>
</fieldset>
</form>
</div>
</div>
</div>
<div class="content pure-u-1 pure-u-lg-3-4">
<div class="posts">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/easter.html"> Osteralbtraum  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2023-09-23T19:45:00+02:00">23.09.2023</time>
<span class="languages-in-article">
<span class="language">
<a href="https://blog.schawe.me/en/easter.html"><i class="fa fa-globe"></i> en</a>
</span>
</span>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#code-ref">Code</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#python-ref">Python</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Ostern ist ein Feiertag, dessen Zeitpunkt mit einer Regel festgelegt wird, die unnötig kompliziert scheint. Der erste Sonntag nach dem ersten Vollmond im Frühling. Den meisten bleibt da als Lösung nicht viel mehr übrig als in einem Kalender nachzusehen welches Datum es denn wohl ist und sich auf den Kalenderhersteller zu verlassen. Aber nicht mit mir! Ich werde es Big-Calendar zeigen und hier die geheime Formel veröffentlichen, mit der man das Osterdatum berechnet!</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">easter</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">date</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">year</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">y</span> <span class="o">%</span> <span class="mi">19</span> <span class="o">+</span> <span class="mi">1</span>                    <span class="c1"># golden number</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span>                  <span class="c1"># century</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">12</span>             <span class="c1"># correction: dropped leap years</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">//</span> <span class="mi">25</span> <span class="o">-</span> <span class="mi">5</span>         <span class="c1"># correction: synchronize with moon's orbit</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>         <span class="c1"># find sunday</span>
    <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="n">g</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">30</span>    <span class="c1"># epact</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">25</span> <span class="ow">and</span> <span class="n">g</span> <span class="o">&gt;</span> <span class="mi">11</span> <span class="ow">or</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">44</span> <span class="o">-</span> <span class="n">e</span>                        <span class="c1"># full moon in march</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">30</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span>           <span class="c1"># advance to next sunday</span>
    <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">31</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">31</span> <span class="k">else</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
</code></pre></div>
<p>Mir persönlich gefällt besonders gut, dass jede Zeile schlimmer ist als die vorherige.</p>
<p>Dieser Algorithmus ist übrigens von Lilius und Clavius Ende des 16. Jahrunderts entwickelt worden. Ich bin durch eine Erwähnung in einer Übungsaufgabe in Donald Knuths <em>The Art of Computer Programming 1</em> (Third edition, S. 159f) darauf gestoßen.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/pirshow.html"> pirShow  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2022-10-08T12:31:00+02:00">08.10.2022</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#python-ref">Python</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Alte Monitore sind zu Schade zum Entsorgen. Als Upcycling habe ich deshalb
einen alten Monitor zu einem digitalen Bilderrahmen in meinem Flur umfunktioniert.
Sinnvollerweise sollte er natürlich nur dann ein Bild zeigen, wenn auch jemand da ist,
der es betrachten kann. Hier möchte ich einmal kurz beschreiben, wie ich einen
Raspberry Pi, einen passiven Bewegungssensor und etwas Python-Code zu diesem Zweck benutze.</p>
<h2>Bildquellen definieren</h2>
<p>Die Hauptfunktionalität eines digitalen Bilderrahmens ist es natürlich Bilder anzuzeigen.
Diese Bilder sollen aus mehreren Quellen zufällig ausgewählt werden. Dabei habe ich mir
einige Flickr-Accounts über Raumfahrt und meine Twitter-Bots ausgesucht. Zuerst brauchen
wir also etwas Code, um die Bilder herunterzuladen.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">flickr</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">flickrapi</span>
    <span class="kn">from</span> <span class="nn">keys_and_secrets</span> <span class="kn">import</span> <span class="n">keys_and_secrets</span>

    <span class="n">url_template</span> <span class="o">=</span> <span class="s1">'http://farm</span><span class="si">%(farm_id)s</span><span class="s1">.staticflickr.com/</span><span class="si">%(server_id)s</span><span class="s1">/</span><span class="si">%(photo_id)s</span><span class="s1">_</span><span class="si">%(secret)s</span><span class="s1">_b.jpg'</span>

    <span class="k">def</span> <span class="nf">url_for_photo</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">url_template</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s1">'server_id'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'server'</span><span class="p">),</span>
            <span class="s1">'farm_id'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'farm'</span><span class="p">),</span>
            <span class="s1">'photo_id'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span>
            <span class="s1">'secret'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="n">flickr</span> <span class="o">=</span> <span class="n">flickrapi</span><span class="o">.</span><span class="n">FlickrAPI</span><span class="p">(</span><span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"flickr_key"</span><span class="p">],</span> <span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"flickr_secret"</span><span class="p">])</span>

    <span class="n">photo</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">flickr</span><span class="o">.</span><span class="n">photos</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">500</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">purl</span> <span class="o">=</span> <span class="n">url_for_photo</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'title'</span><span class="p">)</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">save_image</span><span class="p">(</span><span class="n">purl</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fname</span>


<span class="k">def</span> <span class="nf">twitter</span><span class="p">(</span><span class="n">atname</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">tweepy</span>
    <span class="kn">from</span> <span class="nn">keys_and_secrets</span> <span class="kn">import</span> <span class="n">keys_and_secrets</span>

    <span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"consumer_key"</span><span class="p">],</span> <span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"consumer_secret"</span><span class="p">])</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"access_token_key"</span><span class="p">],</span> <span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"access_token_secret"</span><span class="p">])</span>

    <span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
    <span class="n">tweets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="n">atname</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"media"</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">"media"</span><span class="p">]:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s2">"media_url"</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">"thumb"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">id_str</span><span class="p">))</span>

    <span class="n">purl</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">save_image</span><span class="p">(</span><span class="n">purl</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fname</span>
</code></pre></div>
<p>Dann bauen wir uns einen praktischen Decorator, den wir nutzen, um unterschiedliche Accounts
als Bildquellen zu registrieren.</p>
<div class="highlight"><pre><span></span><code><span class="n">sources</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="n">source_name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">source_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">sources</span><span class="p">[</span><span class="n">source_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func_wrapper</span>
    <span class="k">return</span> <span class="n">source_decorator</span>


<span class="nd">@source</span><span class="p">(</span><span class="s2">"apollo"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">apollo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">flickr</span><span class="p">(</span><span class="s2">"projectapolloarchive"</span><span class="p">)</span>


<span class="nd">@source</span><span class="p">(</span><span class="s2">"randomGraphs"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">randomGraphs</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">twitter</span><span class="p">(</span><span class="s2">"@randomGraphs"</span><span class="p">)</span>


<span class="nd">@source</span><span class="p">(</span><span class="s2">"AFractalADay"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">AFractalADay</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">twitter</span><span class="p">(</span><span class="s2">"@AFractalADay"</span><span class="p">)</span>
</code></pre></div>
<p>Dies ermöglicht es dann sehr komfortabel zufällige Bilder herunterzuladen und anzuzeigen.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">random_image</span><span class="p">():</span>
    <span class="n">image_getter</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">image_getter</span><span class="p">()</span>
    <span class="c1"># show image</span>
    <span class="c1"># skipped terminating old instance of feh and aquiring a mutex</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
    <span class="n">env</span><span class="p">[</span><span class="s2">"DISPLAY"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">":0"</span>
    <span class="n">VIEWER</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"feh"</span><span class="p">,</span> <span class="s2">"-FZYx"</span><span class="p">,</span> <span class="n">fname</span><span class="p">],</span>
        <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>
</code></pre></div>
<h2>Monitor ein- und ausschalten</h2>
<p>Jetzt, da wir Bilder zum Anzeigen haben, müssen wir den Monitor ein- und ausschalten, damit man sie sieht
bzw. damit wir nicht sinnlos Strom verbrauchen. Hier rufen wir wieder Kommandozeilen-Werkzeuge auf:
<code>tvservice</code> schaltet den Standby-Modus des Monitors um und <code>chvt</code> wechselt einmal vom X-Server weg und
wieder zurück, was den Bildschirmschoner beendet.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Timer</span><span class="p">,</span> <span class="n">Lock</span>

<span class="n">MUTEX</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
<span class="n">STATE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">monitor</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">STATE</span>
    <span class="c1"># needs to run as root</span>
    <span class="c1"># make sure that sudo will not ask for a password for these commands</span>
    <span class="c1"># e.g. use visudo to add</span>
    <span class="c1"># piruser ALL=(ALL) NOPASSWD: /usr/bin/tvservice, /bin/chvt</span>
    <span class="k">with</span> <span class="n">MUTEX</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">STATE</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">"sudo tvservice -p; sleep 0.5; sudo chvt 6; sleep 0.5; sudo chvt 7"</span><span class="p">)</span>
            <span class="n">STATE</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">STATE</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">"sudo tvservice -o"</span><span class="p">)</span>
                <span class="c1"># download and show the next image</span>
                <span class="n">random_image</span><span class="p">()</span>
            <span class="n">STATE</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
<h2><span class="caps">PIR</span></h2>
<p>Jetzt müssen wir diese Funktionalität nur noch durch einen Bewegungssensor auslösen. Dazu
schließen wir einfach einen Pyroelektrischen Infrarot Sensor (<span class="caps">PIR</span>) an beispielsweise Pin 23 und
sagen dem Raspberry, dass er dort horchen soll, ob ein Signal anliegt.</p>
<p><a href="/img/pirShow.webp"><img alt="Ein PIR Bewegungsensor, der an einen Raspberry Pi angeschlossen ist" height="2271" src="/img/pirShow1200.webp" width="3660"/></a></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>

<span class="n">SENSOR_PIN</span> <span class="o">=</span> <span class="mi">23</span>

<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SENSOR_PIN</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">add_event_detect</span><span class="p">(</span><span class="n">SENSOR_PIN</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">RISING</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">pir_callback</span><span class="p">)</span>
</code></pre></div>
<p>Der <code>pir_callback</code> schaltet dann einfach den Monitor an und startet einen Timer,
der den Monitor wieder ausstellt (dieser Timer wird abgebrochen sobald der Callback
erneut aufgerufen wird, damit der Monitor an bleibt, solange jemand das Bild betrachtet.)</p>
<p>Der <code>pir_callback</code> sendet außerdem auch eine <span class="caps">MQTT</span>-Nachricht, um die Bewegungsmeldung
auch für Home-Assistant-Automatisierungen zu nutzen, sodass die Beleuchtung im Flur
nach Sonnenuntergang nun auch durch Bewegungen ausgelöst wird.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/kunstliche-kunst.html"> Künstliche Kunst  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2022-10-05T18:05:00+02:00">05.10.2022</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#bild-ref">Bild</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#github-ref">GitHub</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#neural-networks-ref">Neural Networks</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#python-ref">Python</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#twitter-bot-ref">Twitter-Bot</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Seit der Vorstellung von <a href="https://de.wikipedia.org/wiki/DALL-E"><span class="caps">DALL</span>-E</a> Anfang 2021 sind Text-zu-Bild-Programme
im Bewusstsein der Öffentlichkeit angekommen. <span class="caps">DALL</span>-E 2.0 und <a href="https://en.wikipedia.org/wiki/Midjourney">Midjourney</a>
haben immer wieder mit interessanten, verrückten und überraschend gut aussehenden Bildern auf sich aufmerksam
gemacht, die aber immer nur in sehr begrenztem Umfang von ausgewählten Usern auf Servern der Betreibern
generiert werden konnten. Aber seit August 2022 gibt es mit <a href="https://en.wikipedia.org/wiki/Stable_Diffusion">Stable Diffusion</a>
das erste hochwertige Text-zu-Bild-Modell, dessen Neuronales Netzwerk offen ist und von
jedem (der eine Grafikkarte mit genügend Speicher hat) auf dem eigenen Computer genutzt werden kann!</p>
<p>Die grundlegende Funktionsweise ist, dass man dem Modell eine Bildbeschreibung, sogenannte <em>Prompts</em>, gibt und das Modell
versucht ein Bild zu rendern, das möglichst gut zu der Beschreibung passt. Die Kunst liegt nun darin,
die Bildbeschreibung so zu formulieren, dass das resultierende Bild möglichst gut wird.
Wenn wir wissen wollen, wie so eine künstliche Intelligenz überhaupt aussieht, können wir Stable Diffusion
darum bitten uns ein Bild von einer zu malen mit dem Prompt „a painting of an artificial intelligence“:</p>
<p><img alt="a painting of an artificial intelligence" height="512" src="img/painting_of_ai.webp" width="512"/></p>
<p>In der Community findet man häufig Prompts, die mit vielen Adjektiven (wie „intricate“ oder „highly detailed“)
oder Künstlernamen (vor allem „Greg Rutkowski“) gespickt sind. Für mich persönlich klingt es nach zu viel Arbeit
eine solche Liste von Schlüsselworten an eine knappe Bildbeschreibung zu hängen — ich benutze schließlich
eine künstliche Intelligenz, die Bilder zeichnet, damit ich wenig Arbeit habe!</p>
<p>Die offensichtliche Lösung für dieses Problem ist es natürlich ein Sprachmodell zu benutzen, um Prompts zu
generieren. Glücklicherweise gibt es mit <a href="https://lexica.art">lexica.art</a> eine Datenbank von Prompts, die
man nutzen kann, um ein <a href="https://en.wikipedia.org/wiki/GPT-2"><span class="caps">GPT</span>-2</a> Modell zu finetunen. So kann man <span class="caps">GPT</span>-2
Modell mit „four dimensional space whale“ füttern, <span class="caps">GPT</span>-2 macht daraus den Prompt
„four dimensional space whale, with recursive spiral eyes, concept art, high detail, intimidating, cinematic, Artstation trending, octane render“,
der von Stable Diffusion zu diesem Bild gerendert wird:</p>
<p><img alt="Ein vierdimensionaler Weltraumwal" height="512" src="img/SpaceWhale2.webp" width="512"/></p>
<p>Und damit ich auch keine Arbeit damit habe, die Bilder selbst zu generieren, habe ich einen Twitter-Bot
damit beauftragt täglich ein lovecraft’sches Bild zu tweeten: <a href="https://twitter.com/ACthulhuADay">@ACthulhuADay</a>.</p>
<p>Der Glue-Code, der diesen text2prompt2image-Ablauf implementiert (also
hauptsächlich Modelle von Huggingface herunterlädt) und diesen Bot antreibt, findet
sich auf <a href="https://github.com/surt91/ACthulhuADay">Github</a>.</p>
</div>
</article>
</div>
<div class="post-navigation">
<nav class="pagination">
<a href="https://blog.schawe.me/category/code2.html">Älter →</a>
<br/>
            1 / 13
        </nav>
</div>
</div>
<div id="last-update">
<time datetime="2024-12-27 10:29:03">10:29:03 27.12.2024</time>
</div>
</div>
<script async="" src="/theme/webassets-external/0cf7968c252ead5c096e55c1f7673096_rythm.js"></script>
<script async="" src="/theme/webassets-external/a8b690a4c23c0610ea6538a9352534be_totally_serious_script.js"></script>
<script async="" src="/theme/js/unregister_service_worker.js"></script>
</body>
</html>