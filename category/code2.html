<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>möchte­gern­geek - Code category</title>
<meta content="Dinge, die ich für hübsch, praktisch oder interessant halte." name="description"/>
<meta content="Hendrik Schawe" name="author"/>
<meta content="Hendrik Schawe" name="copyright"/>
<meta content="#3d4f5d" name="theme-color"/>
<link href="/manifest.json" rel="manifest"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Add to home screen for Safari on iOS-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="möchtegerngeek" name="apple-mobile-web-app-title"/>
<link href="/extra/icons/icon-152x152.png" rel="apple-touch-icon"/>
<!-- Add to home screen for Windows-->
<meta content="/extra/icons/icon-152x152.png" name="msapplication-TileImage"/>
<meta content="#b0cadb" name="msapplication-TileColor"/>
<meta content="möchte­gern­geek" property="og:site_name"/>
<meta content="Hendrik Schawe" property="og:article:author"/>
<meta content="article" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://blog.schawe.me/img/logo.png" property="og:image"/>
<meta content="https://blog.schawe.me/img/logo.png" name="twitter:image"/>
<link href="https://blog.schawe.me/category/code2.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/en/category/code2.html" hreflang="en" rel="alternate">
<link href="https://blog.schawe.me/category/code2.html" hreflang="x-default" rel="alternate">
<link href="/theme/webassets-external/6fc8b5d0286641a8981481d8734adb14_pure-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/webassets-external/cd1fc9b8f4fd6935866873d6d3cfad1b_grids-responsive-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/blog.css" rel="stylesheet" type="text/css"/>
<script async="" src="/theme/js/mathjax-config.js"></script>
<script async="" crossorigin="anonymous" data-search-pseudo-elements="" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
<!-- Preload the other fonts early -->
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptRegular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Bold.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptItalic.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-bold.woff2" rel="prefetch" type="font/woff2"/>
<link href="https://blog.schawe.me/feeds/all.atom.xml" rel="alternate" title="möchte­gern­geek - Full Atom Feed" type="application/atom+xml">
</link></link></link></link></head>
<body>
<div class="pure-g" id="layout">
<div class="sidebar pure-u-1 pure-u-lg-1-4">
<div class="header">
<h1 class="brand-title"><a href="https://blog.schawe.me">möchte­gern­geek</a></h1>
<nav class="nav">
<ul class="nav-list container">
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/"><i class="fa fa-globe"></i> en</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/categories.html">Kategorien</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/tags.html">Tags</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/archives.html">Archiv</a>
</li>
</ul>
</nav>
<div class="container">
<a class="sidebar-social-links" href="https://hendrik.schawe.me" rel="noopener" target="_blank" title="Ich">
<i class="fas fa-user sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://github.com/surt91" rel="noopener" target="_blank" title="GitHub">
<i class="fab fa-github sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="mailto:hendrik.schawe+blog@gmail.com" rel="noopener" target="_blank" title="Email">
<i class="fas fa-envelope sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://twitter.com/surt91" rel="noopener" target="_blank" title="Twitter">
<i class="fab fa-twitter sidebar-social-links"></i>
</a>
</div>
<div class="container">
<form action="https://blog.schawe.me/search.html" class="pure-form">
<fieldset>
<input aria-label="Suche" class="search-query" id="tipue_search_input" name="q" placeholder="Suche" type="text"/>
</fieldset>
</form>
</div>
</div>
</div>
<div class="content pure-u-1 pure-u-lg-3-4">
<div class="posts">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/perfect-snake.html"> Perfect Snake  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2022-05-21T11:03:00+02:00">21.05.2022</time>
<span class="languages-in-article">
<span class="language">
<a href="https://blog.schawe.me/en/perfect-snake.html"><i class="fa fa-globe"></i> en</a>
</span>
</span>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#game-ref">Game</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#github-ref">GitHub</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#java-ref">Java</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#javascript-ref">JavaScript</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#neural-networks-ref">Neural Networks</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#python-ref">Python</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#snake-ref">Snake</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Ich habe auf diesem Blog schon über eine Reihe von Snake Clonen [<a href="https://blog.schawe.me/snake.html">1</a>, <a href="https://blog.schawe.me/msnake.html">2</a>, <a href="https://blog.schawe.me/jsnake.html">3</a>, <a href="https://blog.schawe.me/restfulsnake.html">4</a>, <a href="https://blog.schawe.me/multijsnake.html">5</a>] geschrieben, die zum Teil auch Autopilot-Strategien hatten [<a href="https://blog.schawe.me/pysnake.html">6</a>, <a href="https://blog.schawe.me/rsnake.html">7</a>].
Die Autopiloten waren zwar meist interessant anzusehen — vor allem bei hohen Geschwindigkeiten — aber bei weitem nicht perfekt.</p>
<p>Auch wenn der Titel etwas zu viel verspricht, schafft es dieser Autopilot (zumindest manchmal) perfekte Spiele zu spielen.</p>
<p><img alt="Eine perfekte Partie Snake" height="200" src="/img/perfectsnake.gif" width="200"/></p>
<p>Und falls dieses gif nicht überzeugt, kann man den Autopiloten online
— dank TensorFlow.js — direkt im Browser ausprobieren auf <a href="https://snake.schawe.me/">snake.schawe.me</a>.</p>
<p>Aber was steckt dahinter?</p>
<h2>Neuronale Netze</h2>
<p>Wenn man nicht clever genug ist, eine direkte Lösung für ein Problem zu finden, kann man
versuchen ein neuronales Netz auf die Lösung des Problems zu trainieren. Vor einigen Jahren
hat ein <a href="https://arxiv.org/abs/1312.5602">Artikel</a>, in dem ein neuronales Netz trainiert
wurde alte Atari-Spiele zu spielen, für mediale Aufmerksamkeit gesorgt. Und die gleiche
Idee des <em>Reinforcement Learning</em> werde ich hier (nicht als erster
[<a href="https://github.com/pawel-kieliszczyk/snake-reinforcement-learning">8</a>,
<a href="https://towardsdatascience.com/learning-to-play-snake-at-1-million-fps-4aae8d36d2f1">9</a>])
auf Snake anwenden.</p>
<p>Die grundlegende Idee von Reinforcement Learning ist relativ einsichtig: Wir belohnen
das Modell für gute Entscheidungen, sodass es lernt mehr gute Entscheidungen zu treffen.
In unserem Fall werden gute Entscheidungen dadurch definiert, dass sie zu einer
hohen Punktzahl, also Länge der Schlange am Spielende, führen.</p>
<p>Glücklicherweise können wir auf die Literatur zurückgreifen, wie wir diese grundsätzliche
Idee umsetzen können. Das Modell, für das ich mich entschieden habe, ist ein Actor-Critic
Ansatz. Dabei nutze ich ein neuronales Netz, das als Input den aktuellen Zustand des
Spielfeldes bekommt — wie genau dieser Zustand aussieht, diskutieren wir weiter unten.
Dann geht es durch ein paar Schichten und endet in zwei „Köpfen“. Einer ist der <em>Actor</em>,
mit drei Output-Neuronen, die für „nach links“, „nach rechts“ und „geradeaus weiter“ stehen.
Der andere ist der <em>Critic</em>, der ein Output-Neuron hat, das abschätzt wie lang die
Schlange, ausgehend von der aktuellen Situation, noch werden kann — also wie gut die aktuelle
Situation ist.</p>
<p>Das Training läuft dann so ab, dass ein ganzes Spiel gespielt wird, folgend den Vorschlägen
des Actors mit etwas rauschen, um neue Strategien zu erkunden. Sobald es beendet ist, weil
die Schlange sich oder eine Wand gebissen hat, wird
der Critic mit allen Zuständen des Spielverlaufs darauf trainiert, Schätzungen
abzugeben, die möglichst gut zu der tatsächlich erreichten Länge am Spielende passen.
Außerdem wird der Actor darauf trainiert gute Entscheidungen zu treffen, indem zu den
Zuständen des Spielverlaufs andere Entscheidungen getroffen werden und die Bewertung
des Critic der resultierenden Situationen als Qualität der Entscheidung genutzt wird.
Actor und Critic helfen sich also gegenseitig besser zu werden.
Der gemeinsame Teil des neuronalen Netzes sollte im Idealfall nach genügend gespielten
Spielen dabei ein „Verständnis“ für Snake entwickeln. Genial!</p>
<h2>Technische Nebensächlichkeiten</h2>
<p>Meine Implementierung benutzt die Python Bibliotheken Keras und Tensorflow zum Training
und <a href="https://blog.schawe.me/multijsnake.html">multiJSnake</a> als <em>Environment</em>. Wir steuern also einen
Java-Prozess, um unser neuronales Netz in Python zu trainieren.
Diese Entscheidung ist etwas unorthodox, aber bot Potential für einen Blogpost auf dem
<a href="https://blog.codecentric.de/2021/11/java-klassen-python/">Blog meines Arbeitgebers</a>.</p>
<p>Wir können das Environment getrost als Black-Box betrachten, die dafür sorgt, dass die Regeln
von Snake befolgt werden.</p>
<h2>Lokale Informationen</h2>
<p>Eine der wichtigsten Entscheidungen ist nun, wie der Input in das Modell aussieht.
Die einfachste Variante, die sich auch gut zum Testen eignet, ist die lokale
Information rund um den Kopf der Schlange: Drei Neuronen, die jeweils 1 oder 0 sind,
wenn das Feld links, rechts und geradeaus vom Kopf belegt sind (und acht weitere für
etwas mehr Weitsicht auf die Diagonalen und übernächste Felder vorne, rechts, links und
diesmal auch zurück). Damit die Schlange
auch das Futter finden kann, fügen wir noch 4 weitere Neuronen hinzu, die per 1 oder 0
anzeigen, ob das Futter in, rechts, links oder entgegengesetzt der Bewegungsrichtung
der Schlange ist.</p>
<p>Mit diesem Input füttern wir eine einzelne vollvernetzte Schicht, hinter der wir
direkt die Actor und Critic Köpfe anschließen.</p>
<p><img alt="Layout des neuronalen Netzes mit lokaler Information (Visualisierung: netron)" class="invertable" src="/img/nn_local.svg"/></p>
<p>Das reicht aus, damit die Schlange nach ein paar tausend Trainingsspielen zielstrebig auf das Futter
zusteuert und sich selbst ausweicht. Allerdings reicht es noch nicht, um zu verhindern,
dass sie sich selbst in Schlaufen fängt. Da war der Autopilot von
<a href="https://blog.schawe.me/rsnake.html">rsnake</a> besser.</p>
<p><img alt="Ein paar Spiele mit lokaler Information" height="200" src="/img/nn_local_game.gif" width="200"/></p>
<h2>Globale Informationen</h2>
<p>Um der Schlange eine Chance zu geben zu erkennen, dass sie sich gerade selbst fängt,
sollte man ihr erlauben das ganze Spielfeld zu sehen — schließlich sehen menschliche
Spieler auch das ganze Spielfeld. Bei einem $10 \times 10$ Spielfeld haben wir also
schon mindestens 100 Input-Neuronen, sodass vollvernetzte Schichten zu sehr großen
Modellen führen würden. Stattdessen bietet es sich bei solchen zweidimensionalen
Daten an <a href="https://en.wikipedia.org/wiki/Convolutional_neural_network"><em>convolutional</em> neuronale Netze</a>
zu nutzen. Um es unserer Schlange etwas einfacher zu machen, werden wir unser Spielfeld
in drei Kanäle aufteilen:</p>
<ol>
<li>der Kopf: nur an der Position des Kopfes ist eine 1, der Rest ist 0</li>
<li>der Körper: die Positionen an denen sich der Körper befindet zeigen wie viele Zeitschritte der Körper noch an dieser Position sein wird</li>
<li>das Futter: nur an der Position des Futters ist eine 1, der Rest ist 0</li>
</ol>
<p><img alt="Was ein Mensch sieht und was wir unserem neuronalen Netz zeigen" height="200" src="/img/nn_snake_channels.png" width="830"/></p>
<p>Dies ist auch kein unfairer Vorteil, schließlich sehen menschliche Spieler das Bild auch
mit drei Farbkanälen.</p>
<p>Und damit die Schlange nicht auch noch lernen muss was rechts und links bedeutet,
geben wir dem Actor 4 Outputs, die für Norden, Osten, Süden und Westen stehen.</p>
<p><img alt="Layout des Convolutional-Neural-Networks (Visualisierung: netron)" class="invertable" src="/img/nn_global.svg"/></p>
<p>Dieses Modell-Layout verdient es dann schon eher als <em>Deep Learning</em> bezeichnet zu werden.
Weitere Modell-Parameter, können auf <a href="https://github.com/surt91/multiJSnake">github.com/surt91/multiJSnake</a>
nachgeschlagen werden.</p>
<p>Nach einigen zehntausend Trainingsspielen funktioniert dieses Modell dann
tatsächlich gut genug, um regelmäßig perfekte Spiele auf einem
$10 \times 10$ Spielfeld zu erreichen. Aber da ich es nur auf  $10 \times 10$
Feldern trainiert habe, versagt es leider auf jeder anderen Größe.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/multijsnake.html"> multiJSnake  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2021-09-26T09:27:00+02:00">26.09.2021</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#game-ref">Game</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#github-ref">GitHub</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#java-ref">Java</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#javascript-ref">JavaScript</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#snake-ref">Snake</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Vor Kurzem habe ich ein Server-Client Snake in meine Liste von simplen
Snake-Clonen [<a href="https://blog.schawe.me/snake.html">1</a>, <a href="https://blog.schawe.me/pysnake.html">2</a>, <a href="https://blog.schawe.me/msnake.html">3</a>, <a href="https://blog.schawe.me/rsnake.html">4</a>, <a href="https://blog.schawe.me/jsnake.html">5</a>, <a href="https://blog.schawe.me/restfulsnake.html">6</a>]
eingereiht. Wie ich in meinem Artikel <a href="https://blog.schawe.me/restfulsnake.html">„RestfulSnake“</a>
bereits angedeutet hatte, habe ich es um eine Multiplayer Komponente erweitert.</p>
<p><img alt="multiJSnake" height="400" src="/img/multisnake.gif" width="400"/></p>
<p>Das grundlegende Design ist, dass der Server in festen Intervallen den nächsten Zeitschritt berechnet,
den Spielzustand an alle Spieler schickt und auf Steuerkommandos von den Spielern lauscht. Dass der
Server die gesamte Spiellogik verwaltet ist einerseits möglich, weil Snake einen relativ kleinen Zustand
hat und nicht extrem empfindlich auf Latenzen reagiert. Außerdem können Spieler nicht (so einfach) schummeln,
wenn der Spiel-Zustand auf dem Server berechnet wird.</p>
<p>Hier sehen wir auch schon das erste Problem für die alte Kommunikation per http: Da der Server nicht von sich aus
Nachrichten an die Clients schicken kann, müssten die Clients pollen, was zu einem ganzen Haufen an Problemen
führen kann (Poll kurz vor dem Tick zum nächsten Zeitschritt, Last, uneinheitliche Antwortzeiten und Races bei
schlechtem Netzwerk, …)
Genau für diesen Zweck sind aber <a href="https://de.wikipedia.org/wiki/WebSocket">Websocket</a>-Verbindungen wie geschaffen!
Da SpringBoot vernünftige Mechanismen mitbringt, um Websockets zu handhaben, ist die Umstellung sogar
<a href="https://github.com/surt91/multiJSnake/commit/927f3bc02c9a3e024048b7d7111969c3cc304aff">vergleichsweise schmerzfrei</a>.</p>
<p>Das größte Problem ist nun, dass die meisten Leute „Rest“ als synonym für „json über http“ verstehen. Also
muss ein neuer Name her — leider war „multisnake“ auf Heroku schon belegt, sodass ich mit „multiJSnake“
subtil darauf hinweise, dass Java und JavaScript das fundament bilden.</p>
<p>Ausprobiert werden kann es auf <a href="https://multijsnake.herokuapp.com/">multijsnake.herokuapp.com</a> und weitere
Spieler können durch einen Einladungslink in die eigene Session eingeladen werden. Die Quellen sind natürlich
auf Github: <a href="https://github.com/surt91/multiJSnake/tree/v0.2.0">github.com/surt91/multiJSnake</a>.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/restfulsnake.html"> RestfulSnake  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2021-07-29T13:48:00+02:00">29.07.2021</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#game-ref">Game</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#github-ref">GitHub</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#java-ref">Java</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#javascript-ref">JavaScript</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#snake-ref">Snake</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Vor wenigen Monaten hatte ich eine handvoll Bewerbungsgespräche. Von „Programmieraufgaben“,
die durch das Erkennen der Fibonacci-Sequenz gelöst wurden bis zu „Wie viele Grashalme
gibt es in deiner Heimatstadt?“ war alles dabei. Unter anderem auch „Wir glauben,
dass du noch nie Java angefasst hast, deshalb sollst du ein Programm in Java schreiben,
über das wir nächste Woche reden können!“</p>
<p>Also bin ich jetzt Java-Experte. Und das bedeutet, dass es Zeit ist für eine weitere
Snake-Version [<a href="https://blog.schawe.me/snake.html">1</a>, <a href="https://blog.schawe.me/pysnake.html">2</a>, <a href="https://blog.schawe.me/msnake.html">3</a>, <a href="https://blog.schawe.me/rsnake.html">4</a>, <a href="https://blog.schawe.me/jsnake.html">5</a>].</p>
<p>Um besonders professionell zu wirken, habe ich mich für eine <em>Client-Server-Architektur</em>
entschieden. Steuerkommandos werden per <code>http</code> <code>post</code> zum Server geschickt und in der Antwort
steht die neue Position der Schlange.
Das Backend nutzt <em>Spring Boot</em> und läuft auf einem Tomcat Server. Das
Frontend besteht hauptsächlich aus dem Visualisierungs-Code von <a href="https://blog.schawe.me/jsnake.html">jsnake</a>,
aber echte Nerds werden es natürlich bevorzugen per <em>curl</em> zu spielen.</p>
<p>Normalerweise würde man es natürlich mittels Kubernetes und Docker auf <span class="caps">AWS</span> laufen lassen, aber
stattdessen habe ich mich dafür entschieden Heroku zu nutzen, um ein
<a href="https://en.wikipedia.org/wiki/Salesforce">kleines Unternehmen</a> zu unterstützen.
Auf <a href="https://multijsnake.herokuapp.com/">multijsnake.herokuapp.com</a> kann man also eine Partie
spielen. Und die Quellen liegen wie immer auf <a href="https://github.com/surt91/multiJSnake/tree/RestfulSnake">GitHub</a></p>
<p>Überraschenderweise funktioniert das tatsächlich erstaunlich gut — solange die Latenz unter ~150 ms bleibt.
Und dieses Design schreit geradezu nach einen Multiplayer-Modus…</p>
</div>
</article>
</div>
<div class="post-navigation">
<nav class="pagination">
<a href="https://blog.schawe.me/category/code.html">← Neuer</a>
<span class="separatordot">·</span>
<a href="https://blog.schawe.me/category/code3.html">Älter →</a>
<br/>
            2 / 13
        </nav>
</div>
</div>
<div id="last-update">
<time datetime="2025-10-29 22:34:37">22:34:37 29.10.2025</time>
</div>
</div>
<script async="" src="/theme/webassets-external/0cf7968c252ead5c096e55c1f7673096_rythm.js"></script>
<script async="" src="/theme/webassets-external/a8b690a4c23c0610ea6538a9352534be_totally_serious_script.js"></script>
<script async="" src="/theme/js/unregister_service_worker.js"></script>
</body>
</html>