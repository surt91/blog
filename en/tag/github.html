<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>möchte­gern­geek - GitHub tag</title>
<meta content="Things I consider pretty, practical or interesting." name="description"/>
<meta content="Hendrik Schawe" name="author"/>
<meta content="Hendrik Schawe" name="copyright"/>
<meta content="#3d4f5d" name="theme-color"/>
<link href="/manifest.json" rel="manifest"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Add to home screen for Safari on iOS-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="möchtegerngeek" name="apple-mobile-web-app-title"/>
<link href="/extra/icons/icon-152x152.png" rel="apple-touch-icon"/>
<!-- Add to home screen for Windows-->
<meta content="/extra/icons/icon-152x152.png" name="msapplication-TileImage"/>
<meta content="#b0cadb" name="msapplication-TileColor"/>
<meta content="möchte­gern­geek" property="og:site_name"/>
<meta content="Hendrik Schawe" property="og:article:author"/>
<meta content="article" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://blog.schawe.me/img/logo.png" property="og:image"/>
<meta content="https://blog.schawe.me/img/logo.png" name="twitter:image"/>
<link href="https://blog.schawe.me/tag/github.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/tag/github.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/tag/github.html" hreflang="x-default" rel="alternate">
<link href="/theme/css/pure-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/grids-responsive-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/blog.css" rel="stylesheet" type="text/css"/>
<script async="" src="/theme/js/mathjax-config.js"></script>
<script async="" crossorigin="anonymous" data-search-pseudo-elements="" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
<!-- Preload the other fonts early -->
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptRegular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Bold.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptItalic.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-bold.woff2" rel="prefetch" type="font/woff2"/>
<link href="https://blog.schawe.me/feeds/all.atom.xml" rel="alternate" title="möchte­gern­geek - Full Atom Feed" type="application/atom+xml">
</link></link></link></link></head>
<body>
<div class="pure-g" id="layout">
<div class="sidebar pure-u-1 pure-u-lg-1-4">
<div class="header">
<h1 class="brand-title"><a href="https://blog.schawe.me/en">möchte­gern­geek</a></h1>
<nav class="nav">
<ul class="nav-list container">
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/"><i class="fa fa-globe"></i> de</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/categories.html">Categories</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/tags.html">Tags</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/archives.html">Archive</a>
</li>
</ul>
</nav>
<div class="container">
<a class="sidebar-social-links" href="https://hendrik.schawe.me" rel="noopener" target="_blank" title="Ich">
<i class="fas fa-user sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://github.com/surt91" rel="noopener" target="_blank" title="GitHub">
<i class="fab fa-github sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="mailto:hendrik.schawe+blog@gmail.com" rel="noopener" target="_blank" title="Email">
<i class="fas fa-envelope sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://twitter.com/surt91" rel="noopener" target="_blank" title="Twitter">
<i class="fab fa-twitter sidebar-social-links"></i>
</a>
</div>
<div class="container">
<form action="https://blog.schawe.me/en/search.html" class="pure-form">
<fieldset>
<input aria-label="Search" class="search-query" id="tipue_search_input" name="q" placeholder="Search" type="text"/>
</fieldset>
</form>
</div>
</div>
</div>
<div class="content pure-u-1 pure-u-lg-3-4">
<div class="posts">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/en/perfect-snake.html"> Perfect Snake  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2022-05-21T11:03:00+02:00">05/21/2022</time>
<span class="languages-in-article">
<span class="language">
<a href="https://blog.schawe.me/en/../perfect-snake.html"><i class="fa fa-globe"></i> de</a>
</span>
</span>
<span class="category category-code">
<a href="https://blog.schawe.me/en/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#game-ref">Game</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#github-ref">GitHub</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#java-ref">Java</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#javascript-ref">JavaScript</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#neural-networks-ref">Neural Networks</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#python-ref">Python</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/en/tags.html#snake-ref">Snake</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>I like the game snake — not so much playing it, but implementing it. The natural consequence
is an autopilot. This way I can just watch instead of playing. On the German version of this
blog, there are already quite a few implementations with different heuristics, but nothing
particularly good at playing Snake.</p>
<p>But now I present an autopilot which can (at least sometimes) play a perfect game of Snake.</p>
<p><img alt="A perfect game of Snake" height="200" src="/img/perfectsnake.gif" width="200"/></p>
<p>In case this gif does not convince you, this autopilot can run directly in the browser
at <a href="https://snake.schawe.me/">snake.schawe.me</a>.</p>
<p>So, how does it work?</p>
<h2>Neural Networks</h2>
<p>If one does not know how to solve something, try to make a neural net come up with a solution.
One example of this applied to classic Atari games was <a href="https://arxiv.org/abs/1312.5602">this paper</a>,
from ten years ago. We will apply this idea of reinforcement learning to snake in this post
(but of course others have done this already
[<a href="https://github.com/pawel-kieliszczyk/snake-reinforcement-learning">8</a>,
<a href="https://towardsdatascience.com/learning-to-play-snake-at-1-million-fps-4aae8d36d2f1">9</a>]).</p>
<p>The fundamental idea of reinforcement learning is quite simple. Just reward the model for
good decision, such that it may learn to make good decisions. So here we will use the score
defined as the length of the snake at the end of the game as the objective which is
maximized by good decisions.</p>
<p>Fortunately, there is already a lot of literature how reinforcement learning can be
implemented. We will use the actor-critic approach. So we construct a neural network
which takes the current state of the game as input and splits into two heads. One
head is the <em>Actor</em> with 3 outputs, which correspond to the next action to take: “right”,
“left” or “straight ahead”. The other head is the <em>Critic</em> with one output representing
an estimate of how long the snake can grow from the current situation.</p>
<p>For training a full game is played by following the advice of the Actor plus a bit of noise
to explore new strategies. Then the Critic is trained with all encountered game states
to produce estimates for the final score, which should predict the score that was indeed
reached.
For training the Actor, we take states of the game, make a different decision and
ask the Critic how good the resulting situation is. Depending on the estimated quality,
we teach the actor to make this decision more or less often.
So Actor and Critic help each other at getting better and
the common part of the neural net should gain an “Understanding” of the game which both
can base their output on. Ingenious!</p>
<h2>Technical Trivialities</h2>
<p>My Implementation uses the Python libraries Keras and Tensorflow for training and
<a href="https://blog.schawe.me/multijsnake.html">multiJSnake (German post)</a> as
the <em>environment</em>. It is a strange decision to implement the environment in Java.
The reason is that it already existed and the combination offered the opportunity
to write a post on the
<a href="https://blog.codecentric.de/en/2021/11/java-classes-python/">blog of my employer</a>.</p>
<p>For this post, we will just treat the environment as a black box, which enforces the
rules of Snake.</p>
<h2>Lokal Information</h2>
<p>One of the most important decisions when designing the model is to determine
the nature of the input. The simplest option, which is quite suited for testing,
is using the local information around the head of the snake: three neurons (0 or 1)
indicating whether the field right, left and ahead are occupied by a wall or the
snake body (and eight more for the diagonals and two fields, left, right, ahead and behind
for a bit more farsightedness). Also we have to indicate where the food is, which
we solve with 4 further neurons (0 or 1) representing whether the food is left,
right, in or against the direction of the snake’s movement.</p>
<p>Behind the input we build a fully connected layer and behind that we
connect directly the two heads.</p>
<p><img alt="Layout of the local neural network (Visualisierung: netron)" src="/img/nn_local.svg"/></p>
<p>And after a few thousand training games
the snake moves directly towards the food and avoids itself. But it is not
yet clever enough to avoid catching itself in loops.
Well, even the heuristic of <a href="https://blog.schawe.me/rsnake.html">rsnake (German post)</a>
was better.</p>
<p><img alt="A few games with local information" height="200" src="/img/nn_local_game.gif" width="200"/></p>
<h2>Global Information</h2>
<p>To avoid the snake trapping itself, we should give it global information of the
playing field — it is only fair, since humans do see the whole field, too.
But even with a <span class="math">\(10 \times 10\)</span> field, there would be at least 100 input neurons,
such that fully connected layers would lead to very large models. Instead,
<a href="https://en.wikipedia.org/wiki/Convolutional_neural_network"><em>convolutional</em> neural networks</a>
seem like a very good fit to solve this problem, especially since our input is
of two-dimensional nature. To make life for our artificial intelligence a bit
easier, we split our playing field in three channels</p>
<ol>
<li>the Head: only the position of the head has a 1, otherwise 0</li>
<li>the body: the  positions of the body have a value corresponding to the number of timesteps they will be occupied</li>
<li>the food: only the position of the food has a 1, otherwise 0</li>
</ol>
<p><img alt="The human view and what we show our neural net" height="200" src="/img/nn_snake_channels.png" width="830"/></p>
<p>This is not even an advantage for the snake, since a human player also sees with three
color channels.</p>
<p>And to make life for our snake even easier, we change the output of the actor from
three relative (left, right, ahead) to four absolute (north, east, south, west) directions.</p>
<p><img alt="Layout of the convolutional neural networks (Visualisierung: netron)" src="/img/nn_global.svg"/></p>
<p>This model layout deserves to be called <em>deep learning</em>. The other model parameters
can be looked up at <a href="https://github.com/surt91/multiJSnake">github.com/surt91/multiJSnake</a>.</p>
<p>And after a few tenthousand training games this model works well enough to
routinely play perfect games on a <span class="math">\(10 \times 10\)</span> field.
And since I only trained it on a  <span class="math">\(10 \times 10\)</span> field, it fails on every other size.</p>
</div>
</article>
</div>
<div class="post-navigation">
<nav class="pagination">
<br/>
            1 / 1
        </nav>
</div>
</div>
<div id="last-update">
<time datetime="2024-12-27 10:29:03">10:29:03 27.12.2024</time>
</div>
</div>
<script async="" src="/theme/fx/rythm.js"></script>
<script async="" src="/theme/fx/totally_serious_script.js"></script>
<script async="" src="/theme/js/unregister_service_worker.js"></script>
</body>
</html>