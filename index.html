<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>möchte­gern­geek</title>
<meta content="Dinge, die ich für hübsch, praktisch oder interessant halte." name="description"/>
<meta content="Hendrik Schawe" name="author"/>
<meta content="Hendrik Schawe" name="copyright"/>
<meta content="#3d4f5d" name="theme-color"/>
<link href="/manifest.json" rel="manifest"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Add to home screen for Safari on iOS-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="möchtegerngeek" name="apple-mobile-web-app-title"/>
<link href="/extra/icons/icon-152x152.png" rel="apple-touch-icon"/>
<!-- Add to home screen for Windows-->
<meta content="/extra/icons/icon-152x152.png" name="msapplication-TileImage"/>
<meta content="#b0cadb" name="msapplication-TileColor"/>
<meta content="möchte­gern­geek" property="og:site_name"/>
<meta content="Hendrik Schawe" property="og:article:author"/>
<meta content="article" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://blog.schawe.me/img/logo.png" property="og:image"/>
<meta content="https://blog.schawe.me/img/logo.png" name="twitter:image"/>
<link href="https://blog.schawe.me/index.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/en/index.html" hreflang="en" rel="alternate">
<link href="https://blog.schawe.me/index.html" hreflang="x-default" rel="alternate">
<link href="/theme/webassets-external/6fc8b5d0286641a8981481d8734adb14_pure-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/webassets-external/cd1fc9b8f4fd6935866873d6d3cfad1b_grids-responsive-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/blog.css" rel="stylesheet" type="text/css"/>
<script async="" src="/theme/js/mathjax-config.js"></script>
<script async="" crossorigin="anonymous" data-search-pseudo-elements="" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
<!-- Preload the other fonts early -->
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptRegular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Bold.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptItalic.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-bold.woff2" rel="prefetch" type="font/woff2"/>
<link href="https://blog.schawe.me/feeds/all.atom.xml" rel="alternate" title="möchte­gern­geek - Full Atom Feed" type="application/atom+xml">
</link></link></link></link></head>
<body>
<div class="pure-g" id="layout">
<div class="sidebar pure-u-1 pure-u-lg-1-4">
<div class="header">
<h1 class="brand-title"><a href="https://blog.schawe.me">möchte­gern­geek</a></h1>
<nav class="nav">
<ul class="nav-list container">
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/"><i class="fa fa-globe"></i> en</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/categories.html">Kategorien</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/tags.html">Tags</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/archives.html">Archiv</a>
</li>
</ul>
</nav>
<div class="container">
<a class="sidebar-social-links" href="https://hendrik.schawe.me" rel="noopener" target="_blank" title="Ich">
<i class="fas fa-user sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://github.com/surt91" rel="noopener" target="_blank" title="GitHub">
<i class="fab fa-github sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="mailto:hendrik.schawe+blog@gmail.com" rel="noopener" target="_blank" title="Email">
<i class="fas fa-envelope sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://twitter.com/surt91" rel="noopener" target="_blank" title="Twitter">
<i class="fab fa-twitter sidebar-social-links"></i>
</a>
</div>
<div class="container">
<form action="https://blog.schawe.me/search.html" class="pure-form">
<fieldset>
<input aria-label="Suche" class="search-query" id="tipue_search_input" name="q" placeholder="Suche" type="text"/>
</fieldset>
</form>
</div>
</div>
</div>
<div class="content pure-u-1 pure-u-lg-3-4">
<h3 class="post-header">Vorgeschlagener Eintrag</h3>
<div class="post-pinned">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/welcome.html"> Willkommen auf meinem Blog!  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2021-05-21T20:37:00+02:00">21.05.2021</time>
<span class="languages-in-article">
<span class="language">
<a href="https://blog.schawe.me/en/welcome.html"><i class="fa fa-globe"></i> en</a>
</span>
</span>
<span class="category category-meta">
<a href="https://blog.schawe.me/categories.html#meta-ref">Meta</a>
</span>
</div>
</header>
<div class="post-content">
<p>Hier veröffentliche ich unregelmäßig
Artikel über Dinge, mit denen ich mich beschäftige, oder die ich
so nützlich finde, dass ich sie später nachschlagen will.</p>
<p>Neuen Besuchern möchte ich eine handvoll Beiträge empfehlen, anstatt
chronologisch herunterzuscrollen:</p>
<ul>
<li><a href="https://blog.schawe.me/randomFractals.html">A Fractal A Day</a>
   zeigt hübsche Fraktale meines Twitter Bots <a href="https://twitter.com/AFractalADay">@AFractalADay</a>.</li>
<li><a href="https://blog.schawe.me/paper-lis2.html">Number of longest increasing subsequences</a>
   stellt eine akademische Veröffentlichung, an der ich beteiligt war,
   und ihren zentralen Algorithmus vor.</li>
<li><a href="https://blog.schawe.me/perfect-snake.html">Perfect Snake</a> präsentiert eine meiner
   Implementierungen des Spiels „snake“ mitsamt einem neuronalen Netz als Autopilot.</li>
</ul>
</div>
</article>
</div>
<h3 class="post-header">Neuste Einträge</h3>
<div class="posts">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/schneckenkragen.html"> Schneckenkragen  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2024-05-10T12:29:00+02:00">10.05.2024</time>
<span class="category category-misc">
<a href="https://blog.schawe.me/categories.html#misc-ref">Misc</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#3d-druck-ref">3D-Druck</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#bild-ref">Bild</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#garten-ref">Garten</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Besonders in diesem Jahr, aber zumindest in meinem Garten jedes Jahr, sind Schnecken ein
großes Problem für Hobbygärtner. Man setzt die liebevoll vorgezogenen Pflanzen von der Fenterbank
in das Beet, nur um am nächsten Tag zu sehen, dass außer Schleimspuren nichts geblieben ist.
Es gibt eine Reihe Hausmittel, die helfen sollen. Praktischerweise im
<a href="https://de.wikipedia.org/wiki/Schneckenbek%C3%A4mpfung#Biologische_und_%C3%B6kologische_Mittel">Wikipedia-Artikel zur Schneckenbekämpfung</a> zusammengefasst:</p>
<ul>
<li>Bannkreise aus Eierschalen oder Kaffeepulver</li>
<li>Bierfallen, die alle Schnecken aus der Nachbarschaft einladen</li>
<li>Kupfer, das nicht nur für Schnecken giftig ist</li>
<li>Laufenten — immerhin werden die Pflanzen dann nicht mehr von Schnecken gefressen</li>
</ul>
<p>Drei dieser vier Strategien haben außerdem den Nachteil, dass sie nicht nur die Wegschnecken bekämpfen,
die für die meisten Fraßschäden verantwortlich sind, sondern alle Schnecken.
Tatsächlich sind Schnecken mit Gehäuse keine Gefahr für die Nutzpflanzen — im Gegenteil: laut des Wikipedia-Artikels gibt es anscheindend eher den Zusammenhang, dass eine große Weinbergschneckenpopulation mit eher kleinen Populationen der schädlichen Wegschnecke korreliert ist. Und auch nicht alle Nacktschnecken sind schädlich! Meine Lieblingsnacktschnecke, <a href="https://de.wikipedia.org/wiki/Tigerschnegel">der Tigerschnegel</a>, frisst nicht nur Schneckeneier, sondern sogar ausgewachsene Exemplare.</p>
<h2>Der Schneckenkragen</h2>
<p>In meinem Garten hat sich <a href="https://de.wikipedia.org/wiki/Schneckenkragen">der Schneckenkragen</a> bewährt.
Das ist ein hohler Zylinder mit Widerhaken nach außen.
Einfacher an einem Bild zu zeigen als zu beschreiben.</p>
<p><a href="/img/schneckenkragen.jpg"><img alt="Schneckenkragen" height="904" src="/img/schneckenkragen1200.webp" width="1200"/></a></p>
<p>Dort, wo die 3D-gedruckte Schnecke abgebildet ist, sollte keine Schnecke mehr hingelangen können.</p>
<p>Man steckt ihn einfach mit einer leicht drehenden Bewegung etwa 2 cm tief in den Boden.</p>
<p>Dabei ist unbedingt zu beachten, dass andere Pflanzen nicht zu dicht am Kragen stehen dürfen, da die Schnecken sie
ansonsten als Brücken nutzen können.</p>
<p>Und natürlich sollte man sicherstellen, dass sich keine Schnecke im Inneren des Schneckenkragens befindet.
Sie verstecken sich gerne unter Steinchen oder Ästen.
Am besten lockert man den Boden innerhalb des Scheckenkragens daher einmal auf
und befördert dabei zutage tretende Schnecken heraus.</p>
<p>Auch wenn man alles beachtet, kann es sein, dass in der Erde noch Schneckeneier sind, die innerhalb des Kragens schlüpfen.</p>
<p>Man muss also dennoch regelmäßig nachschauen. Aber zumindest in meinem Garten, ist der Unterschied zwischen geschützten und ungeschützten Pflanzen gewaltig.</p>
<p>Die Funktionsweise ist anscheinend nicht ganz klar. Erklärungsansätze, die ich finden konnte, sind, dass der Wechsel von
„senkrecht nach oben“ zu „45° nach unten“ nicht im Verhaltensrepertoire von Schnecken enthalten ist. Und dass der Kragen dazu
führt, dass die Schnecken auf dem Weg nach oben den Geruch der Pflanzen verlieren und dann verwirrt wieder nach unten kriechen.</p>
<h3>Upgrade</h3>
<p>Nach meinen (leidvollen) Erfahrungen finden in besonders schneckenreichen Beeten bei feuchtem Wetter einige Schnecken dennoch in den Kragen. Das scheint daran zu liegen, dass sich Schnecken in den Knick verkriechen. Von da aus kriechen sie dann später in eine zufällige Richtung — entweder in den Kragen hinein oder wieder herunter. Zumindest vermute ich, dass dies der Mechanismus ist.</p>
<p><a href="/img/schnecken.webp"><img alt="Schnecken im Knick des Kragens" height="804" src="/img/schnecken1200.webp" width="1200"/></a></p>
<p>Wenn die Annahme richtig ist, müssen wir also nur verhindern, dass die Schnecken es sich in dem Knick gemütlich machen. In der Einleitung hatte ich kurz erwähnt, dass Schnecken Kupfer vermeiden, denn Kupfer ist giftig für Weichtiere (sowie Einzeller und viele Wassertiere). Der Mechanismus ist anscheinend, dass Schneckenschleim leicht sauer ist und bei Kontakt leicht Kupferionen löst, die für die Schnecke giftig und unangenehm sind. Dafür muss die Schnecke allerdings ausreichend lange Kontakt mit dem Kupfer haben, sodass ein Kupferdraht, der um das Beet liegt, keine Schnecken abschreckt.</p>
<p>Wir können aber das Kupfer nutzen, um die Schnecken davon abzuhalten, sich in dem Knick aufzuhalten, indem wir einen Streifen Kupferfolie möglichst weit oben um den Kragen kleben. Gleichzeitig ist das Kupfer dort unter dem „Dach“ vor Regen geschützt, sodass die Exposition der Umgebung minimiert wird.</p>
<p><a href="/img/schneckenkragen_kupfer.jpg"><img alt="Schneckenkragen mit Kupferring" height="791" src="/img/schneckenkragen_kupfer1200.webp" width="1200"/></a></p>
<h3>Upgrade 2 — Electric Boogaloo</h3>
<p>Wenn dies immer noch nicht ausreicht, um die Pflanzen hinreichend zu schützen, gibt es noch die Möglichkeit den Kragen zu einem Elektrozaun zu modifizieren. Dazu klebt man zwei Streifen Kupferband um den Kragen, sodass sie sich nicht berühren und schließt sie an eine 9 V Batterie an. Um die 9 V Batterie zu halten, habe ich eine Variante des Kragens mit einer Halterung und einer Öffnung für die Kabel erstellt. Damit die Batterie nicht nass wird, sollte man die Oberseite der Öffnung mit Silikonkleber abdichten.</p>
<p><a href="/img/schneckenkragen_batterie.jpg"><img alt="Schneckenkragen mit Batteriefach" height="675" src="/img/schneckenkragen_batterie1200.webp" width="1200"/></a></p>
<p><a href="/img/schneckenkragen_elektro.jpg"><img alt="Schneckenkragen mit Elektrozaun" height="904" src="/img/schneckenkragen_elektro1200.webp" width="1200"/></a></p>
<p>Wenn Schnecken nun hochkriechen, schließen sie den Stromkreis und bekommen einen Stromschlag. In der Regel sollten sie sich zurückziehen oder betäubt werden und herunterfallen. Falls diese Methode zu lethal für die Schnecken ist, kann noch ein Widerstand in Reihe an einen der Pole gelötet werden.</p>
<h3>Fertigung</h3>
<p>Die Fertigung gelingt mit einem 3D-Drucker. Ich habe hierfür ein <a href="https://www.printables.com/model/909211-schneckenkragen-2-electric-boogaloo-slug-collar">einfaches Modell designt</a>.
Leider benötigt ein hinreichend großer Schneckenkragen, der stabil genug ist, um ihn in den Boden drücken zu können,
relativ viel Filament. Bei dem Filament sollte man darauf achten, dass es <span class="caps">UV</span>-beständig ist, wie <span class="caps">PETG</span> oder <span class="caps">ASA</span>.
Das sorgt dafür, dass er in der Sonne nicht spröde wird und man ihn viele Jahre nutzen kann.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/easter.html"> Osteralbtraum  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2023-09-23T19:45:00+02:00">23.09.2023</time>
<span class="languages-in-article">
<span class="language">
<a href="https://blog.schawe.me/en/easter.html"><i class="fa fa-globe"></i> en</a>
</span>
</span>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#code-ref">Code</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#python-ref">Python</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Ostern ist ein Feiertag, dessen Zeitpunkt mit einer Regel festgelegt wird, die unnötig kompliziert scheint. Der erste Sonntag nach dem ersten Vollmond im Frühling. Den meisten bleibt da als Lösung nicht viel mehr übrig als in einem Kalender nachzusehen welches Datum es denn wohl ist und sich auf den Kalenderhersteller zu verlassen. Aber nicht mit mir! Ich werde es Big-Calendar zeigen und hier die geheime Formel veröffentlichen, mit der man das Osterdatum berechnet!</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">easter</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">date</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">year</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">y</span> <span class="o">%</span> <span class="mi">19</span> <span class="o">+</span> <span class="mi">1</span>                    <span class="c1"># golden number</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">y</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">1</span>                  <span class="c1"># century</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">12</span>             <span class="c1"># correction: dropped leap years</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">//</span> <span class="mi">25</span> <span class="o">-</span> <span class="mi">5</span>         <span class="c1"># correction: synchronize with moon's orbit</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>         <span class="c1"># find sunday</span>
    <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span> <span class="o">*</span> <span class="n">g</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">30</span>    <span class="c1"># epact</span>
    <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">25</span> <span class="ow">and</span> <span class="n">g</span> <span class="o">&gt;</span> <span class="mi">11</span> <span class="ow">or</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">44</span> <span class="o">-</span> <span class="n">e</span>                        <span class="c1"># full moon in march</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">30</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span>           <span class="c1"># advance to next sunday</span>
    <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">31</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">31</span> <span class="k">else</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
</code></pre></div>
<p>Mir persönlich gefällt besonders gut, dass jede Zeile schlimmer ist als die vorherige.</p>
<p>Dieser Algorithmus ist übrigens von Lilius und Clavius Ende des 16. Jahrunderts entwickelt worden. Ich bin durch eine Erwähnung in einer Übungsaufgabe in Donald Knuths <em>The Art of Computer Programming 1</em> (Third edition, S. 159f) darauf gestoßen.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/pirshow.html"> pirShow  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2022-10-08T12:31:00+02:00">08.10.2022</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#python-ref">Python</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Alte Monitore sind zu Schade zum Entsorgen. Als Upcycling habe ich deshalb
einen alten Monitor zu einem digitalen Bilderrahmen in meinem Flur umfunktioniert.
Sinnvollerweise sollte er natürlich nur dann ein Bild zeigen, wenn auch jemand da ist,
der es betrachten kann. Hier möchte ich einmal kurz beschreiben, wie ich einen
Raspberry Pi, einen passiven Bewegungssensor und etwas Python-Code zu diesem Zweck benutze.</p>
<h2>Bildquellen definieren</h2>
<p>Die Hauptfunktionalität eines digitalen Bilderrahmens ist es natürlich Bilder anzuzeigen.
Diese Bilder sollen aus mehreren Quellen zufällig ausgewählt werden. Dabei habe ich mir
einige Flickr-Accounts über Raumfahrt und meine Twitter-Bots ausgesucht. Zuerst brauchen
wir also etwas Code, um die Bilder herunterzuladen.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">flickr</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">flickrapi</span>
    <span class="kn">from</span> <span class="nn">keys_and_secrets</span> <span class="kn">import</span> <span class="n">keys_and_secrets</span>

    <span class="n">url_template</span> <span class="o">=</span> <span class="s1">'http://farm</span><span class="si">%(farm_id)s</span><span class="s1">.staticflickr.com/</span><span class="si">%(server_id)s</span><span class="s1">/</span><span class="si">%(photo_id)s</span><span class="s1">_</span><span class="si">%(secret)s</span><span class="s1">_b.jpg'</span>

    <span class="k">def</span> <span class="nf">url_for_photo</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">url_template</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s1">'server_id'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'server'</span><span class="p">),</span>
            <span class="s1">'farm_id'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'farm'</span><span class="p">),</span>
            <span class="s1">'photo_id'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'id'</span><span class="p">),</span>
            <span class="s1">'secret'</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="n">flickr</span> <span class="o">=</span> <span class="n">flickrapi</span><span class="o">.</span><span class="n">FlickrAPI</span><span class="p">(</span><span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"flickr_key"</span><span class="p">],</span> <span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"flickr_secret"</span><span class="p">])</span>

    <span class="n">photo</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">flickr</span><span class="o">.</span><span class="n">photos</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">500</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">purl</span> <span class="o">=</span> <span class="n">url_for_photo</span><span class="p">(</span><span class="n">photo</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'title'</span><span class="p">)</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">save_image</span><span class="p">(</span><span class="n">purl</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fname</span>


<span class="k">def</span> <span class="nf">twitter</span><span class="p">(</span><span class="n">atname</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">tweepy</span>
    <span class="kn">from</span> <span class="nn">keys_and_secrets</span> <span class="kn">import</span> <span class="n">keys_and_secrets</span>

    <span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"consumer_key"</span><span class="p">],</span> <span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"consumer_secret"</span><span class="p">])</span>
    <span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"access_token_key"</span><span class="p">],</span> <span class="n">keys_and_secrets</span><span class="p">[</span><span class="s2">"access_token_secret"</span><span class="p">])</span>

    <span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="o">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>
    <span class="n">tweets</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="n">atname</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"media"</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">entities</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">entities</span><span class="p">[</span><span class="s2">"media"</span><span class="p">]:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">j</span><span class="p">[</span><span class="s2">"media_url"</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">"thumb"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                    <span class="n">urls</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">url</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">id_str</span><span class="p">))</span>

    <span class="n">purl</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="n">save_image</span><span class="p">(</span><span class="n">purl</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fname</span>
</code></pre></div>
<p>Dann bauen wir uns einen praktischen Decorator, den wir nutzen, um unterschiedliche Accounts
als Bildquellen zu registrieren.</p>
<div class="highlight"><pre><span></span><code><span class="n">sources</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="n">source_name</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">source_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">sources</span><span class="p">[</span><span class="n">source_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>

        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">func_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func_wrapper</span>
    <span class="k">return</span> <span class="n">source_decorator</span>


<span class="nd">@source</span><span class="p">(</span><span class="s2">"apollo"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">apollo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">flickr</span><span class="p">(</span><span class="s2">"projectapolloarchive"</span><span class="p">)</span>


<span class="nd">@source</span><span class="p">(</span><span class="s2">"randomGraphs"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">randomGraphs</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">twitter</span><span class="p">(</span><span class="s2">"@randomGraphs"</span><span class="p">)</span>


<span class="nd">@source</span><span class="p">(</span><span class="s2">"AFractalADay"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">AFractalADay</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">twitter</span><span class="p">(</span><span class="s2">"@AFractalADay"</span><span class="p">)</span>
</code></pre></div>
<p>Dies ermöglicht es dann sehr komfortabel zufällige Bilder herunterzuladen und anzuzeigen.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">random_image</span><span class="p">():</span>
    <span class="n">image_getter</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">sources</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="n">image_getter</span><span class="p">()</span>
    <span class="c1"># show image</span>
    <span class="c1"># skipped terminating old instance of feh and aquiring a mutex</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
    <span class="n">env</span><span class="p">[</span><span class="s2">"DISPLAY"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">":0"</span>
    <span class="n">VIEWER</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"feh"</span><span class="p">,</span> <span class="s2">"-FZYx"</span><span class="p">,</span> <span class="n">fname</span><span class="p">],</span>
        <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>
</code></pre></div>
<h2>Monitor ein- und ausschalten</h2>
<p>Jetzt, da wir Bilder zum Anzeigen haben, müssen wir den Monitor ein- und ausschalten, damit man sie sieht
bzw. damit wir nicht sinnlos Strom verbrauchen. Hier rufen wir wieder Kommandozeilen-Werkzeuge auf:
<code>tvservice</code> schaltet den Standby-Modus des Monitors um und <code>chvt</code> wechselt einmal vom X-Server weg und
wieder zurück, was den Bildschirmschoner beendet.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Timer</span><span class="p">,</span> <span class="n">Lock</span>

<span class="n">MUTEX</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
<span class="n">STATE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">monitor</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">STATE</span>
    <span class="c1"># needs to run as root</span>
    <span class="c1"># make sure that sudo will not ask for a password for these commands</span>
    <span class="c1"># e.g. use visudo to add</span>
    <span class="c1"># piruser ALL=(ALL) NOPASSWD: /usr/bin/tvservice, /bin/chvt</span>
    <span class="k">with</span> <span class="n">MUTEX</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">STATE</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">"sudo tvservice -p; sleep 0.5; sudo chvt 6; sleep 0.5; sudo chvt 7"</span><span class="p">)</span>
            <span class="n">STATE</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">STATE</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">"sudo tvservice -o"</span><span class="p">)</span>
                <span class="c1"># download and show the next image</span>
                <span class="n">random_image</span><span class="p">()</span>
            <span class="n">STATE</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
<h2><span class="caps">PIR</span></h2>
<p>Jetzt müssen wir diese Funktionalität nur noch durch einen Bewegungssensor auslösen. Dazu
schließen wir einfach einen Pyroelektrischen Infrarot Sensor (<span class="caps">PIR</span>) an beispielsweise Pin 23 und
sagen dem Raspberry, dass er dort horchen soll, ob ein Signal anliegt.</p>
<p><a href="/img/pirShow.webp"><img alt="Ein PIR Bewegungsensor, der an einen Raspberry Pi angeschlossen ist" height="2271" src="/img/pirShow1200.webp" width="3660"/></a></p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>

<span class="n">SENSOR_PIN</span> <span class="o">=</span> <span class="mi">23</span>

<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">SENSOR_PIN</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">add_event_detect</span><span class="p">(</span><span class="n">SENSOR_PIN</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">RISING</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">pir_callback</span><span class="p">)</span>
</code></pre></div>
<p>Der <code>pir_callback</code> schaltet dann einfach den Monitor an und startet einen Timer,
der den Monitor wieder ausstellt (dieser Timer wird abgebrochen sobald der Callback
erneut aufgerufen wird, damit der Monitor an bleibt, solange jemand das Bild betrachtet.)</p>
<p>Der <code>pir_callback</code> sendet außerdem auch eine <span class="caps">MQTT</span>-Nachricht, um die Bewegungsmeldung
auch für Home-Assistant-Automatisierungen zu nutzen, sodass die Beleuchtung im Flur
nach Sonnenuntergang nun auch durch Bewegungen ausgelöst wird.</p>
</div>
</article>
</div>
<div class="post-navigation">
<nav class="pagination">
<a href="https://blog.schawe.me/index2.html">Älter →</a>
<br/>
            1 / 23
        </nav>
</div>
</div>
<div id="last-update">
<time datetime="2025-10-29 22:34:37">22:34:37 29.10.2025</time>
</div>
</div>
<script async="" src="/theme/webassets-external/0cf7968c252ead5c096e55c1f7673096_rythm.js"></script>
<script async="" src="/theme/webassets-external/a8b690a4c23c0610ea6538a9352534be_totally_serious_script.js"></script>
<script async="" src="/theme/js/unregister_service_worker.js"></script>
</body>
</html>