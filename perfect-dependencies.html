<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Perfect Dependencies  · möchte­gern­geek</title>
<meta content="Man hat ein großes C++ Projekt, ändert einen Header, führt make aus und ein seltsamer Fehler tritt im Programm auf. Das liegt natürlich daran, dass make nicht alle Quelldateien neu kompiliert hat, die den Header einbinden. Woher sollte make das auch wissen? Alle Header per Hand in der Makefile einzutragen …" name="description"/>
<meta content="Hendrik Schawe" name="author"/>
<meta content="Hendrik Schawe" name="copyright"/>
<meta content="#3d4f5d" name="theme-color"/>
<link href="/manifest.json" rel="manifest"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Add to home screen for Safari on iOS-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="möchtegerngeek" name="apple-mobile-web-app-title"/>
<link href="/extra/icons/icon-152x152.png" rel="apple-touch-icon"/>
<!-- Add to home screen for Windows-->
<meta content="/extra/icons/icon-152x152.png" name="msapplication-TileImage"/>
<meta content="#b0cadb" name="msapplication-TileColor"/>
<meta content="möchte­gern­geek" property="og:site_name"/>
<meta content="Hendrik Schawe" property="og:article:author"/>
<meta content="article" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="make, C++, Code, " name="keywords"/>
<meta content="Perfect Dependencies " name="twitter:title">
<meta content="Man hat ein großes C++ Projekt, ändert einen Header, führt make aus und ein seltsamer Fehler tritt im Programm auf. Das liegt natürlich daran, dass make nicht alle Quelldateien neu kompiliert hat, die den Header einbinden. Woher sollte make das auch wissen? Alle Header per Hand in der Makefile einzutragen …" name="twitter:description">
<meta content="Perfect Dependencies " name="og:title">
<meta content="Man hat ein großes C++ Projekt, ändert einen Header, führt make aus und ein seltsamer Fehler tritt im Programm auf. Das liegt natürlich daran, dass make nicht alle Quelldateien neu kompiliert hat, die den Header einbinden. Woher sollte make das auch wissen? Alle Header per Hand in der Makefile einzutragen …" name="og:description">
<meta content="perfect-dependencies.html" property="og:url">
<meta content="2016-09-17T20:27:00+02:00" property="og:article:published_time">
<meta content="https://blog.schawe.me/img/logo.png" property="og:image"/>
<meta content="https://blog.schawe.me/img/logo.png" name="twitter:image"/>
<link href="https://blog.schawe.me/perfect-dependencies.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/en/perfect-dependencies.html" hreflang="en" rel="alternate">
<link href="https://blog.schawe.me/perfect-dependencies.html" hreflang="x-default" rel="alternate">
<link href="/theme/webassets-external/6fc8b5d0286641a8981481d8734adb14_pure-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/webassets-external/cd1fc9b8f4fd6935866873d6d3cfad1b_grids-responsive-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/blog.css" rel="stylesheet" type="text/css"/>
<script async="" src="/theme/js/mathjax-config.js"></script>
<script async="" crossorigin="anonymous" data-search-pseudo-elements="" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
<!-- Preload the other fonts early -->
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptRegular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Bold.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptItalic.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-bold.woff2" rel="prefetch" type="font/woff2"/>
<link href="https://blog.schawe.me/feeds/all.atom.xml" rel="alternate" title="möchte­gern­geek - Full Atom Feed" type="application/atom+xml">
</link></link></link></link></meta></meta></meta></meta></meta></meta></head>
<body>
<div class="pure-g" id="layout">
<div class="sidebar pure-u-1 pure-u-lg-1-4">
<div class="header">
<h1 class="brand-title"><a href="https://blog.schawe.me">möchte­gern­geek</a></h1>
<nav class="nav">
<ul class="nav-list container">
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/"><i class="fa fa-globe"></i> en</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/categories.html">Kategorien</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/tags.html">Tags</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/archives.html">Archiv</a>
</li>
</ul>
</nav>
<div class="container">
<a class="sidebar-social-links" href="https://hendrik.schawe.me" rel="noopener" target="_blank" title="Ich">
<i class="fas fa-user sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://github.com/surt91" rel="noopener" target="_blank" title="GitHub">
<i class="fab fa-github sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="mailto:hendrik.schawe+blog@gmail.com" rel="noopener" target="_blank" title="Email">
<i class="fas fa-envelope sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://twitter.com/surt91" rel="noopener" target="_blank" title="Twitter">
<i class="fab fa-twitter sidebar-social-links"></i>
</a>
</div>
<div class="container">
<form action="https://blog.schawe.me/search.html" class="pure-form">
<fieldset>
<input aria-label="Suche" class="search-query" id="tipue_search_input" name="q" placeholder="Suche" type="text"/>
</fieldset>
</form>
</div>
</div>
</div>
<div class="content pure-u-1 pure-u-lg-3-4">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/perfect-dependencies.html"> Perfect Dependencies  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2016-09-17T20:27:00+02:00">17.09.2016</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#c-ref">C++</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#make-ref">make</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Man hat ein großes C++ Projekt, ändert einen Header, führt <code>make</code> aus und
ein seltsamer Fehler tritt im Programm auf. Das liegt natürlich daran, dass
<code>make</code> nicht alle Quelldateien neu kompiliert hat, die den Header einbinden.
Woher sollte <code>make</code> das auch wissen? Alle Header per Hand in der <code>Makefile</code>
einzutragen und zu pflegen, ist Wahnsinn und wird den Programmierer in denselben treiben.</p>
<p><code>make</code> ist ein sehr allgemein gehaltenes Programm, wie ich in einem <a href="https://blog.schawe.me/make.html">vorherigen Eintrag</a>
gezeigt habe. Sich um Eigenheiten von C oder C++ zu kümmern fällt also nicht
in den Aufgabenbereich von <code>make</code>. Aber glücklicherweise gibt es ein Programm,
dessen Hauptaufgabe es ist, sich mit den Eigenheiten von C bzw. C++ auszukennen:
den Compiler.
Tatsächlich bietet (zumindest <span class="caps">GCC</span>) die Option eine C oder C++ Datei zu parsen
und alle inkludierten Header auszugeben.</p>
<div class="highlight"><pre><span></span><code>g++<span class="w"> </span>-MM<span class="w"> </span>myCode.cpp
</code></pre></div>
<p>Das ausnutzend, bietet die <a href="https://www.gnu.org/software/make/manual/">offizielle Dokumentation</a>
von <code>GNU make</code> folgende Rule, um je eine „dependency“ <code>Makefile</code>
pro <code>.c</code> Datei zu erzeugen und automatisch einzubinden.</p>
<div class="highlight"><pre><span></span><code><span class="nf">%.d</span><span class="o">:</span><span class="w"> </span>%.<span class="n">c</span>
<span class="w">    </span>@set<span class="w"> </span>-e<span class="p">;</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$@</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="k">$(</span>CC<span class="k">)</span><span class="w"> </span>-M<span class="w"> </span><span class="k">$(</span>CPPFLAGS<span class="k">)</span><span class="w"> </span>$&lt;<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$@</span>.<span class="nv">$$$$</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sed<span class="w"> </span>’s,<span class="se">\(</span><span class="nv">$*</span><span class="se">\)\.</span>o<span class="o">[</span><span class="w"> </span>:<span class="o">]</span>*,<span class="se">\1</span>.o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>:<span class="w"> </span>,g’<span class="w"> </span>&lt;<span class="w"> </span><span class="nv">$@</span>.<span class="nv">$$$$</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$@</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$@</span>.<span class="nv">$$$$</span>

<span class="cp">include $(sources:.c=.d)</span>
</code></pre></div>
<p>Falls man <code>.o</code> Dateien in ein <code>obj/</code> Verzeichnis speichert, muss man die
Regex anpassen. In meinen Projekten leistet mir diese Rule gute Dienste.</p>
<p>Alternativ könnte man natürlich auf ein anderes Buildsystem statt handgepflegter
Makefiles umsteigen.</p>
</div>
</article>
<div class="post-navigation">
<nav class="pagination">
<a href="https://blog.schawe.me/optipng.html">← Neuer</a>
<span class="separatordot">·</span>
<a href="https://blog.schawe.me/png2mp4.html">Älter →</a>
<br/>
</nav>
</div>
</div>
<div id="last-update">
<time datetime="2024-12-27 10:29:03">10:29:03 27.12.2024</time>
</div>
</div>
<script async="" src="/theme/webassets-external/0cf7968c252ead5c096e55c1f7673096_rythm.js"></script>
<script async="" src="/theme/webassets-external/a8b690a4c23c0610ea6538a9352534be_totally_serious_script.js"></script>
<script async="" src="/theme/js/unregister_service_worker.js"></script>
</body>
</html>