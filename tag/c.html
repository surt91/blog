<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>möchte­gern­geek - C tag</title>
<meta content="Dinge, die ich für hübsch, praktisch oder interessant halte." name="description"/>
<meta content="Hendrik Schawe" name="author"/>
<meta content="Hendrik Schawe" name="copyright"/>
<meta content="#3d4f5d" name="theme-color"/>
<link href="/manifest.json" rel="manifest"/>
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Add to home screen for Safari on iOS-->
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="möchtegerngeek" name="apple-mobile-web-app-title"/>
<link href="/extra/icons/icon-152x152.png" rel="apple-touch-icon"/>
<!-- Add to home screen for Windows-->
<meta content="/extra/icons/icon-152x152.png" name="msapplication-TileImage"/>
<meta content="#b0cadb" name="msapplication-TileColor"/>
<meta content="möchte­gern­geek" property="og:site_name"/>
<meta content="Hendrik Schawe" property="og:article:author"/>
<meta content="article" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="https://blog.schawe.me/img/logo.png" property="og:image"/>
<meta content="https://blog.schawe.me/img/logo.png" name="twitter:image"/>
<link href="https://blog.schawe.me/tag/c.html" hreflang="de" rel="alternate">
<link href="https://blog.schawe.me/en/tag/c.html" hreflang="en" rel="alternate">
<link href="https://blog.schawe.me/tag/c.html" hreflang="x-default" rel="alternate">
<link href="/theme/webassets-external/6fc8b5d0286641a8981481d8734adb14_pure-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/webassets-external/cd1fc9b8f4fd6935866873d6d3cfad1b_grids-responsive-min.css" rel="stylesheet" type="text/css"/>
<link href="/theme/css/blog.css" rel="stylesheet" type="text/css"/>
<script async="" src="/theme/js/mathjax-config.js"></script>
<script async="" crossorigin="anonymous" data-search-pseudo-elements="" integrity="sha512-RXf+QSDCUQs5uwRKaDoXt55jygZZm2V++WUZduaU/Ui/9EGp3f/2KZVahFZBKGH0s774sd3HmrhUy+SgOFQLVQ==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
<!-- Preload the other fonts early -->
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptRegular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/FiraSans-Bold.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/Merriweather-12ptItalic.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-regular.woff2" rel="prefetch" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="/theme/woff2/firacode-bold.woff2" rel="prefetch" type="font/woff2"/>
<link href="https://blog.schawe.me/feeds/all.atom.xml" rel="alternate" title="möchte­gern­geek - Full Atom Feed" type="application/atom+xml">
</link></link></link></link></head>
<body>
<div class="pure-g" id="layout">
<div class="sidebar pure-u-1 pure-u-lg-1-4">
<div class="header">
<h1 class="brand-title"><a href="https://blog.schawe.me">möchte­gern­geek</a></h1>
<nav class="nav">
<ul class="nav-list container">
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/en/"><i class="fa fa-globe"></i> en</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/categories.html">Kategorien</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/tags.html">Tags</a>
</li>
<li class="nav-item">
<a class="pure-button" href="https://blog.schawe.me/archives.html">Archiv</a>
</li>
</ul>
</nav>
<div class="container">
<a class="sidebar-social-links" href="https://hendrik.schawe.me" rel="noopener" target="_blank" title="Ich">
<i class="fas fa-user sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://github.com/surt91" rel="noopener" target="_blank" title="GitHub">
<i class="fab fa-github sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="mailto:hendrik.schawe+blog@gmail.com" rel="noopener" target="_blank" title="Email">
<i class="fas fa-envelope sidebar-social-links"></i>
</a>
<a class="sidebar-social-links" href="https://twitter.com/surt91" rel="noopener" target="_blank" title="Twitter">
<i class="fab fa-twitter sidebar-social-links"></i>
</a>
</div>
<div class="container">
<form action="https://blog.schawe.me/search.html" class="pure-form">
<fieldset>
<input aria-label="Suche" class="search-query" id="tipue_search_input" name="q" placeholder="Suche" type="text"/>
</fieldset>
</form>
</div>
</div>
</div>
<div class="content pure-u-1 pure-u-lg-3-4">
<div class="posts">
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/analog-digital-analoges-thermometer.html"> Analog-Digital-Analoges Thermometer  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2022-10-03T15:18:00+02:00">03.10.2022</time>
<span class="category category-tech">
<a href="https://blog.schawe.me/categories.html#tech-ref">Tech</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#bild-ref">Bild</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#c-ref">C</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#code-ref">Code</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#microcontroller-ref">Microcontroller</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Ich habe mir ein analoges Voltmeter zugelegt und möchte es als Thermometer benutzen.</p>
<p>Da der Widerstand von Metallen mit der Temperatur steigt, kann man Temperatur relativ gut messen, indem man
einen <a href="https://de.wikipedia.org/wiki/Platin-Messwiderstand">kalibrierten Widerstand</a> misst.
Daher kann man theoretisch mit einem Multimeter auch die Temperatur messen. (In der Praxis wird dies
bei Multimetern allerdings in der Regel mithilfe eines <a href="https://de.wikipedia.org/wiki/Thermoelement#Seebeck-Effekt">anderen Effektes</a> erledigt.)</p>
<p>Da ich mir aber keine Gedanken darüber machen möchte, wie ich eine Schaltung aussehen müsste, um <span class="math">\(15°\mathrm{C}\)</span>
in <span class="math">\(1.5 \mathrm{V}\)</span> umzusetzen (vielleicht würde eine <a href="https://de.wikipedia.org/wiki/Br%C3%BCckenschaltung">Brückenschaltung</a>
funktionieren?), wähle ich den einfachen Weg mit einer Reihe integrierter Schaltkreise und einem Microcontroller.</p>
<p><img alt="Schaltplan meines Analog-Digital-Analog-Thermometers" src="/img/analogue_temperature_circuit.svg"/></p>
<p>Hier ist ein günstiger <span class="caps">DS18B20</span> Temperatursensor, der von einem <span class="caps">ESP8266</span> ausgelesen wird. Dieser steuert dann einen
<span class="caps">MCP4725</span> Digital-Analog-Wandler so an, dass er eine Spannung ausgibt, deren Wert in Volt ein Zehntel der gemessenen
Temperatur ist. Diese Spannung wird dann von meinem alten Voltmeter gemessen und angezeigt. Hier ist es also gerade <span class="math">\(24°\mathrm{C}\)</span>.</p>
<p><a href="/img/analogue_temperature.webp"><img alt="Foto meines Analog-Digital-Analog-Thermometers" height="1200" src="/img/analogue_temperature1200.webp" width="1200"/></a></p>
<p>Hier ist übrigens der simple Code, der beispielsweise mit der Arduino <span class="caps">IDE</span> auf einen <span class="caps">ESP8266</span> geflasht werden kann:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Wire.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Adafruit_MCP4725.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;OneWire.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;DallasTemperature.h&gt;</span>

<span class="cp">#define ONE_WIRE_BUS D4</span>
<span class="cp">#define MCP4725In A0</span>

<span class="n">Adafruit_MCP4725</span><span class="w"> </span><span class="n">MCP4725</span><span class="p">;</span>

<span class="n">OneWire</span><span class="w"> </span><span class="nf">oneWire</span><span class="p">(</span><span class="n">ONE_WIRE_BUS</span><span class="p">);</span>
<span class="n">DallasTemperature</span><span class="w"> </span><span class="nf">DS18B20</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oneWire</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>

<span class="w">    </span><span class="n">DS18B20</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// 0x60 is the I2C address of my MCP4725A0</span>
<span class="w">    </span><span class="n">MCP4725</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mh">0x60</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span><span class="w"> </span><span class="nf">getTemperature</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">DS18B20</span><span class="p">.</span><span class="n">requestTemperatures</span><span class="p">();</span>
<span class="w">      </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DS18B20</span><span class="p">.</span><span class="n">getTempCByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">85.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="mf">-127.0</span><span class="p">));</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setVoltage</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">voltageOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="o">*</span><span class="mi">4096</span><span class="o">/</span><span class="mf">3.3</span><span class="p">;</span>
<span class="w">    </span><span class="n">MCP4725</span><span class="p">.</span><span class="n">setVoltage</span><span class="p">(</span><span class="n">voltageOut</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// read it for testing and maybe calibrating</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">adcInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">MCP4725In</span><span class="p">);</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">voltageIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">adcInput</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">3.3</span><span class="w"> </span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="mf">1024.0</span><span class="p">;</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Expected Voltage: "</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Measured Voltage: "</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">voltageIn</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getTemperature</span><span class="p">();</span>
<span class="w">    </span><span class="n">setVoltage</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// send temperature to the serial console</span>
<span class="w">    </span><span class="n">dtostrf</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">temperatureString</span><span class="p">);</span>
<span class="w">    </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">temperatureString</span><span class="p">);</span>

<span class="w">    </span><span class="n">delay</span><span class="p">(</span><span class="mf">1e3</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/pebble-rules.html"> Pebble Rules  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2017-12-10T15:57:00+01:00">10.12.2017</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#bild-ref">Bild</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#c-ref">C</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#code-ref">Code</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#github-ref">GitHub</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Im letzten Monat habe ich jemanden getroffen, auf dessen <a href="http://clisby.net/projects/pebble_app/">Armbanduhr eine <span class="caps">MCMC</span> Simulation von Hamilton-Pfaden</a>
auf einem quadratischen Gitter liefen. Ich war derartig begeistert, dass ich
beschlossen habe auch etwas auf meiner Pebble simulieren zu lassen. Aufgrund
der geringen Auflösung des Displays (<span class="math">\(144 \times 168\)</span>) bieten sich „blockige“
Visualisierungen an. Glücklicherweise habe ich schon genügend Spielereien
geschrieben, die sich eignen
[<a href="https://blog.schawe.me/labyrinthartiger-zellularer-automat.html">1</a>,
    <a href="https://blog.schawe.me/depth-first-search-und-labyrinthe.html">2</a>,
    <a href="https://blog.schawe.me/rule-90.html">3</a>,
    <a href="https://blog.schawe.me/conways-game-of-life.html">4</a>].</p>
<p>Pebble wurde zwar inzwischen von Fitbit aufgekauft, aber das <span class="caps">SDK</span> ist noch
verfügbar. Die neueren Exemplare lassen sich per JavaScript programmieren,
meine „Kickstarter Edition“ aus der ersten Generation allerdings noch nicht.</p>
<p>Da ich meine Uhr also in C programmieren muss, konnte ich allerdings den
den alten Code aus <a href="https://blog.schawe.me/rule-90.html">Wolfram’s Rules</a> wiederbenutzen.</p>
<video autoplay="" class="fixed-size-800" controls="" height="1000" loop="" poster="/img/pebble-rules.jpg" width="800">
<source src="/vid/pebble-rules.mp4" type="video/mp4"/>
Your browser does not support the video tag.
</video>
<p>Der Code ist auf <a href="https://github.com/surt91/pebble-wolfram">GitHub</a> verfügbar.</p>
</div>
</article>
<article class="post">
<header>
<h2 class="post-title">
<a href="https://blog.schawe.me/perfect-dependencies.html"> Perfect Dependencies  </a>
</h2>
<div class="post-meta">
<time class="post-time" datetime="2016-09-17T20:27:00+02:00">17.09.2016</time>
<span class="category category-code">
<a href="https://blog.schawe.me/categories.html#code-ref">Code</a>
</span>
<span class="tags-in-article">
<span class="tag">
<a href="https://blog.schawe.me/tags.html#c-ref">C++</a>
</span>
<span class="tag">
<a href="https://blog.schawe.me/tags.html#make-ref">make</a>
</span>
</span>
</div>
</header>
<div class="post-content">
<p>Man hat ein großes C++ Projekt, ändert einen Header, führt <code>make</code> aus und
ein seltsamer Fehler tritt im Programm auf. Das liegt natürlich daran, dass
<code>make</code> nicht alle Quelldateien neu kompiliert hat, die den Header einbinden.
Woher sollte <code>make</code> das auch wissen? Alle Header per Hand in der <code>Makefile</code>
einzutragen und zu pflegen, ist Wahnsinn und wird den Programmierer in denselben treiben.</p>
<p><code>make</code> ist ein sehr allgemein gehaltenes Programm, wie ich in einem <a href="https://blog.schawe.me/make.html">vorherigen Eintrag</a>
gezeigt habe. Sich um Eigenheiten von C oder C++ zu kümmern fällt also nicht
in den Aufgabenbereich von <code>make</code>. Aber glücklicherweise gibt es ein Programm,
dessen Hauptaufgabe es ist, sich mit den Eigenheiten von C bzw. C++ auszukennen:
den Compiler.
Tatsächlich bietet (zumindest <span class="caps">GCC</span>) die Option eine C oder C++ Datei zu parsen
und alle inkludierten Header auszugeben.</p>
<div class="highlight"><pre><span></span><code>g++<span class="w"> </span>-MM<span class="w"> </span>myCode.cpp
</code></pre></div>
<p>Das ausnutzend, bietet die <a href="https://www.gnu.org/software/make/manual/">offizielle Dokumentation</a>
von <code>GNU make</code> folgende Rule, um je eine „dependency“ <code>Makefile</code>
pro <code>.c</code> Datei zu erzeugen und automatisch einzubinden.</p>
<div class="highlight"><pre><span></span><code><span class="nf">%.d</span><span class="o">:</span><span class="w"> </span>%.<span class="n">c</span>
<span class="w">    </span>@set<span class="w"> </span>-e<span class="p">;</span><span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$@</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="k">$(</span>CC<span class="k">)</span><span class="w"> </span>-M<span class="w"> </span><span class="k">$(</span>CPPFLAGS<span class="k">)</span><span class="w"> </span>$&lt;<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$@</span>.<span class="nv">$$$$</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sed<span class="w"> </span>’s,<span class="se">\(</span><span class="nv">$*</span><span class="se">\)\.</span>o<span class="o">[</span><span class="w"> </span>:<span class="o">]</span>*,<span class="se">\1</span>.o<span class="w"> </span><span class="nv">$@</span><span class="w"> </span>:<span class="w"> </span>,g’<span class="w"> </span>&lt;<span class="w"> </span><span class="nv">$@</span>.<span class="nv">$$$$</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$@</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$@</span>.<span class="nv">$$$$</span>

<span class="cp">include $(sources:.c=.d)</span>
</code></pre></div>
<p>Falls man <code>.o</code> Dateien in ein <code>obj/</code> Verzeichnis speichert, muss man die
Regex anpassen. In meinen Projekten leistet mir diese Rule gute Dienste.</p>
<p>Alternativ könnte man natürlich auf ein anderes Buildsystem statt handgepflegter
Makefiles umsteigen.</p>
</div>
</article>
</div>
<div class="post-navigation">
<nav class="pagination">
<a href="https://blog.schawe.me/tag/c2.html">Älter →</a>
<br/>
            1 / 4
        </nav>
</div>
</div>
<div id="last-update">
<time datetime="2024-12-27 10:29:03">10:29:03 27.12.2024</time>
</div>
</div>
<script async="" src="/theme/webassets-external/0cf7968c252ead5c096e55c1f7673096_rythm.js"></script>
<script async="" src="/theme/webassets-external/a8b690a4c23c0610ea6538a9352534be_totally_serious_script.js"></script>
<script async="" src="/theme/js/unregister_service_worker.js"></script>
</body>
</html>